import{d as q,r as o,o as N,a,b as t,w,e as A,v as U,F as g,f as k,t as l,h as O,i as T,j as n}from"./index-D4Hvh62J.js";import{g as I,u as P,q as R}from"./database-DSeU7js0.js";const $={class:"page-wrapper"},z={class:"card-list"},G={key:0,class:"empty-tip"},H={key:1},J=["onClick"],Q={class:"card-header"},W={class:"card-title"},X={class:"card-date"},Y={class:"card-meta"},Z={class:"card-location"},K={class:"user-list-container"},tt={class:"table-header"},et={class:"user-table"},lt={key:0,class:"empty-tip"},st={key:1,class:"empty-tip"},at={class:"modal-header"},nt={class:"modal-body"},ot={class:"activity-details"},ct={class:"detail-label"},it=["onUpdate:modelValue","placeholder"],vt=q({__name:"EventRegistrations",setup(dt){const p=o([]),c=o(null),D=o(0),h=o([]);o(0);const y=o([]),m=o(!1),r=o(!1),b=o(!1),_=o({}),E={center_id:"中心ID",dates:"活动日期",deadline:"报名截止时间",notes:"备注信息",place:"活动地点",status:"活动状态",title:"活动标题",totalSlots:"总名额"};N(async()=>{L()});async function L(){const s=await I("activity");p.value=s,D.value=s.length,console.log("in function 活动列表:",p.value[0]),console.log("in function 活动数量:",D.value)}async function x(s){var i=s._id;const v=await R("activity_registration",{activity_id:i});console.log("openActivity participants:",v),console.log("number of participants:",v.length);const e=[],u=[];v.forEach(d=>{const M={name:d.name||"",phone:d.phone||"",createdAt:d.createdAt||"",status:d.status||"registered",_id:d._id};d.status==="cancelled"?u.push(M):e.push(M)}),h.value=e,y.value=u}async function F(s){c.value=s,m.value=!0,await x(s)}function V(){r.value=!r.value}function j(){_.value={...c.value},b.value=!0}function f(){b.value=!1}async function B(){Object.keys(E).forEach(s=>{_.value[s]!==void 0&&(c.value[s]=_.value[s])}),console.log("currentActivity保存活动数据:",c.value);try{await P("activity",c.value._id,c.value),console.log("保存活动数据成功")}catch(s){console.error("保存活动数据失败:",s)}finally{f()}}function S(){m.value=!1,c.value=null,h.value=[],y.value=[],r.value=!1}return(s,i)=>{var C,v;return n(),a("div",$,[i[2]||(i[2]=t("h2",null,"活动报名管理页面",-1)),w(t("div",z,[p.value.length===0?(n(),a("div",G,"暂无活动")):(n(),a("div",H,[(n(!0),a(g,null,k(p.value,e=>(n(),a("div",{key:e._id,class:"activity-card",onClick:u=>F(e)},[t("div",Q,[t("h3",W,l(e.title||"未命名活动"),1),t("span",X,l(e.dates||"未设置时间"),1)]),t("div",Y,[t("span",Z,l(e.place||"未设置地点"),1)])],8,J))),128))]))],512),[[U,!m.value]]),w(t("div",K,[t("div",tt,[t("button",{onClick:S,class:"back-btn"},"返回活动列表"),t("h3",null,l(((C=c.value)==null?void 0:C.title)||"活动")+" - 报名用户列表",1),t("button",{onClick:j,class:"activity-manage-btn"},"活动管理"),t("button",{onClick:V,class:"toggle-cancelled-btn"},l(r.value?"隐藏已取消用户":"显示已取消用户"),1)]),t("table",et,[i[1]||(i[1]=t("thead",null,[t("tr",null,[t("th",null,"昵称"),t("th",null,"电话"),t("th",null,"报名时间"),t("th",null,"状态")])],-1)),t("tbody",null,[(n(!0),a(g,null,k(h.value,e=>(n(),a("tr",{key:e._id},[t("td",null,l(e.name||"未填写"),1),t("td",null,l(e.phone||"未填写"),1),t("td",null,l(e.createdAt||"未知"),1),t("td",null,l((e.status==="registered","已报名")),1)]))),128)),r.value?(n(!0),a(g,{key:0},k(y.value,e=>(n(),a("tr",{key:"cancelled-"+e._id},[t("td",null,l(e.name||"未填写"),1),t("td",null,l(e.phone||"未填写"),1),t("td",null,l(e.createdAt||"未知"),1),t("td",null,l((e.status==="cancelled","已取消")),1)]))),128)):A("",!0)])]),h.value.length===0&&y.value.length===0?(n(),a("div",lt,"暂无报名用户")):h.value.length===0&&!r.value?(n(),a("div",st,"暂无报名用户")):A("",!0)],512),[[U,m.value]]),b.value?(n(),a("div",{key:0,class:"modal-mask",onClick:f},[t("div",{class:"modal",onClick:i[0]||(i[0]=O(()=>{},["stop"]))},[t("div",at,[t("h3",null,"活动管理 - "+l(((v=c.value)==null?void 0:v.title)||"未命名活动"),1),t("button",{onClick:f,class:"close-btn"},"×")]),t("div",nt,[t("div",ot,[(n(),a(g,null,k(E,(e,u)=>t("div",{class:"detail-item",key:u},[t("span",ct,l(e)+":",1),w(t("input",{type:"text","onUpdate:modelValue":d=>_.value[u]=d,class:"detail-input",placeholder:e},null,8,it),[[T,_.value[u]]])])),64))])]),t("div",{class:"modal-footer"},[t("button",{onClick:f,class:"btn"},"关闭"),t("button",{onClick:B,class:"btn primary"},"保存")])])])):A("",!0)])}}});export{vt as default};
