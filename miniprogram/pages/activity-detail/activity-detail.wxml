<view class="page">
  <view wx:if="{{activity}}" class="detail-card">
    <view class="hero">
      <view class="hero-mask"></view>
      <view class="hero-title">{{activity.title}}</view>
      <view class="hero-sub">让温暖触手可及</view>
    </view>

    <view class="section">
      <view class="row"><text class="label">日期</text><text class="value">{{displayDate}}</text></view>
      <view class="row"><text class="label">地点</text><text class="value">{{activity.place}}</text></view>
      <view class="row"><text class="label">名额</text><text class="value highlight">余位 {{activity.remainingSlots}}</text></view>
      <view class="row" wx:if="{{activity.deadline}}"><text class="label">截止</text><text class="value">{{activity.deadline}}</text></view>
      <view class="row"><text class="label">电话</text><text class="value">{{activity.contact}}</text></view>
    </view>

    

    <view class="section" wx:if="{{activity.timeSlots && activity.timeSlots.length>1}}">
      <view class="sub-title">选择时间段</view>
      <view class="slots">
        <block wx:for="{{activity.timeSlots}}" wx:key="*this">
          <view class="slot {{selectedTimeSlot===item?'active':''}}" data-slot="{{item}}" bindtap="selectTimeSlot">{{item}}</view>
        </block>
      </view>
    </view>
    <view class="section" wx:if="{{activity.timeSlots && activity.timeSlots.length===1}}">
      <view class="row"><text class="label">时间段</text><text class="value">{{activity.timeSlots[0]}}</text></view>
    </view>

    <!-- 登录状态提示 -->
    <view class="section" wx:if="{{!isLoggedIn}}">
      <view class="login-tip">
        <text class="tip-text">请先登录后再报名活动</text>
        <text class="tip-link" bindtap="goToLogin">去登录</text>
      </view>
    </view>

    <view class="section">
      <view class="desc">本活动为示例，实际内容以主办方为准。报名后请提前到场。</view>
    </view>

    <!-- 交互区：报名或取消（根据是否携带 registrationId 决定） -->
    <block wx:if="{{!registrationId}}">
      <button 
        class="primary-btn {{!isLoggedIn || activity.remainingSlots <= 0 || submitting ? 'disabled' : ''}}" 
        bindtap="reserve"
        disabled="{{!isLoggedIn || activity.remainingSlots <= 0 || submitting}}"
      >
        <text wx:if="{{submitting}}">报名中...</text>
        <text wx:elif="{{!isLoggedIn}}">请先登录</text>
        <text wx:elif="{{activity.remainingSlots <= 0}}">名额已满</text>
        <text wx:else>立即报名</text>
      </button>
    </block>
    <block wx:else>
      <button 
        class="primary-btn" 
        style="background:#ef4444;"
        bindtap="cancelFromDetail"
      >取消预约</button>
    </block>
  </view>
</view>


